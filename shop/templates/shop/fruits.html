
{% extends "base.html" %}
{% block content %}
<h2>Available Fruits </h2>

<div class="fruits-container">
    {% for fruit in fruits %}
    <div class="fruit-card">
        <img src="{{ fruit.image }}" alt="{{ fruit.name }}">
        <strong>{{ fruit.name }}</strong> - â‚¹{{ fruit.price }}
        <br>Stock: {{ fruit.stock }}
        <br>
        {% if fruit.stock > 0 %}
        <a href="{% url 'add_to_cart' fruit.id %}" class="add-to-cart" data-id="{{ fruit.id }}">
            <button>
                <span class="transition"></span>
                <span class="gradient"></span>
                <span class="label">Add to Cart</span>
            </button>
        </a>
        {% else %}
        <strong>Out of Stock</strong>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Message Popup -->
<div id="cart-message"
     style="display:none; position:fixed; top:20px; right:20px; background:green; color:white; padding:10px; border-radius:5px;">
    Added to cart! ðŸ›’
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      function showCartMessage(message) {
        let msg = document.getElementById("cart-message");
        msg.innerText = message;
        msg.style.display = "block";
        setTimeout(() => msg.style.display = "none", 2000);
      }
      updateCartCount();

      document.querySelectorAll(".add-to-cart").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          let fruitId = this.getAttribute("data-id");

          fetch(`/cart/add/${fruitId}/`, {
            method: "GET",
            headers: {
              "X-Requested-With": "XMLHttpRequest"
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.message) {
              showCartMessage(data.message);
            }
            let cartCountElement = document.getElementById("cart-count");
            if (cartCountElement) {
                cartCountElement.innerText = data.cart_count;
            }
          })
          .catch(error => console.error("Error adding to cart:", error));
        });
      });
    });
</script>

{% endblock %}
