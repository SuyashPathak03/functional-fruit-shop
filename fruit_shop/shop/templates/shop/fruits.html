{% extends "base.html" %}
{% block content %}
<h2>Available Fruits </h2>
<ul>
    {% for fruit in fruits %}
    <li>
        <img src="{{ fruit.image }}" alt="{{ fruit.name }}" width="100">
        <strong>{{ fruit.name }}</strong> - ${{ fruit.price }}
        <br>Stock: {{ fruit.stock }}
        <br>
        {% if fruit.stock > 0 %}
        <a href="{% url 'add_to_cart' fruit.id %}" class="add-to-cart" data-id="{{ fruit.id }}">
            <!--            <button>Add to Cart</button>-->
            <button>
                <span class="transition"></span>
                <span class="gradient"></span>
                <span class="label">Add to Cart</span>
            </button>
        </a>

        {% else %}
        <strong>Out of Stock</strong>
        {% endif %}
    </li>
    <hr>
    {% endfor %}
</ul>
<!--<a href="{% url 'cart_detail' %}">-->
<!--    <button>View Cart</button>-->
<!--</a>-->
<!-- Message Popup -->
<div id="cart-message"
     style="display:none; position:fixed; top:20px; right:20px; background:green; color:white; padding:10px; border-radius:5px;">
    Added to cart! ðŸ›’
</div>

<!-- JavaScript for AJAX -->
<!--<script>-->
<!--  document.addEventListener("DOMContentLoaded", function () {-->
<!--    function updateCartDropdown() {-->
<!--      fetch("/cart_preview/")-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--          let cartDropdown = document.getElementById("cart-dropdown-content");-->
<!--          cartDropdown.innerHTML = ""; // Clear previous items-->

<!--          if (data.cart_items.length > 0) {-->
<!--            data.cart_items.forEach(item => {-->
<!--              cartDropdown.innerHTML += `-->
<!--                <li>${item.name} (x${item.quantity}) - $${item.price}</li>-->
<!--              `;-->
<!--            });-->
<!--          } else {-->
<!--            cartDropdown.innerHTML = "<li>Cart is empty</li>";  // âœ… Fix for "cart empty" issue-->
<!--          }-->
<!--        });-->
<!--    }-->

<!--    document.querySelectorAll(".add-to-cart").forEach(button => {-->
<!--      button.addEventListener("click", function () {-->
<!--        let fruitId = this.getAttribute("data-id");-->

<!--        fetch(`/cart/add/${fruitId}/`, {-->
<!--          method: "GET",-->
<!--          headers: {-->
<!--            "X-Requested-With": "XMLHttpRequest"-->
<!--          }-->
<!--        })-->
<!--        .then(response => response.json())-->
<!--        .then(data => {-->
<!--          if (data.message) {-->
<!--            let msg = document.getElementById("cart-message");-->
<!--            msg.style.display = "block";-->
<!--            msg.innerText = data.message;  // âœ… Ensure message is updated-->
<!--            setTimeout(() => msg.style.display = "none", 2000);-->
<!--          }-->
<!--          if (data.cart_count !== undefined) {-->
<!--            document.getElementById("cart-count").innerText = data.cart_count;-->
<!--          }-->

<!--          updateCartDropdown(); // âœ… Refresh cart dropdown after adding-->
<!--        });-->
<!--      });-->
<!--    });-->

<!--    // âœ… Refresh cart when user hovers over "Cart ðŸ›’"-->
<!--    document.getElementById("cart-container").addEventListener("mouseenter", updateCartDropdown);-->
<!--  });-->
<!--</script>-->
<script>
    document.addEventListener("DOMContentLoaded", function () {

      // âœ… Function to Show Cart Message at the Bottom
      function showCartMessage(message) {
        let msg = document.getElementById("cart-message");
        msg.innerText = message;
        msg.style.display = "block";
        setTimeout(() => msg.style.display = "none", 2000); // âœ… Hide after 2 seconds
      }
      updateCartCount();

      // âœ… Handle "Add to Cart" Click with AJAX
      document.querySelectorAll(".add-to-cart").forEach(button => {
        button.addEventListener("click", function (event) {
          event.preventDefault(); // âœ… Prevent full page reload
          let fruitId = this.getAttribute("data-id");

          fetch(`/cart/add/${fruitId}/`, {
            method: "GET",
            headers: {
              "X-Requested-With": "XMLHttpRequest"
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.message) {
              showCartMessage(data.message);
            }

            // âœ… Update Cart Counter
            let cartCountElement = document.getElementById("cart-count");
            if (cartCountElement) {
                cartCountElement.innerText = data.cart_count;
            }
          })
          .catch(error => console.error("Error adding to cart:", error));
        });
      });

    });
</script>


{% endblock %}
